<p-toast [breakpoints]="{ '920px': { width: '100%', right: '0', left: '0' } }" />

@if (loadingtable) {
<div class="flex flex-col items-center justify-center text-center h-full p-4" style="background-color: transparent;">
  <div class="custom-spinner mb-4"></div>
</div>
}

@if (!loadingtable) {
<div class="custom-container">
  <p-panel class="transparente">

    <ng-template pTemplate="header">
      <div class="boton-container">
        <p-button icon="pi pi-angle-double-left" (click)="regresarPanel()" variant="outlined"
          pTooltip="Regresar a Ajustes de Seguridad" tooltipStyleClass="tooltip-custom-1" />
      </div>
      <div class="header-container title-header gap-2">
        <span>
          Bitácora del Sistema de Gestíon Documental de Dirección de Docencia
        </span>
      </div>
    </ng-template>
    <br>

    <p-table #dt [value]="bitacora" [paginator]="true" columnResizeMode="expand" showGridlines
      [tableStyle]="{ 'min-width': '50rem' }" [rows]="5" [rowsPerPageOptions]="[5, 10, 25]" dataKey="id"
      [globalFilterFields]="['idBitacora', 'descripcion', 'accion', 'UsuarioNombreCompleto', 'NombreObjeto']">

      <ng-template pTemplate="caption">
        <div class="toolbar">
          <!-- Botones a la izquierda -->
          <div class="centraciones">
            <!-- Contenedor de los botones a la izquierda -->
            <div class="left-buttons">
              <p-button (onClick)="op.toggle($event)" icon="bi bi-file-earmark-spreadsheet fw-bolder" label="Reportes"
                variant="text" [raised]="true" styleClass="btn fw-bolder custom-1" raised text />
              <p-popover #op>
                <div class="flex flex-col gap-4">
                  <div>
                    <p-button label="PDF" icon="bi bi-filetype-pdf fw-medium icon-big"
                      styleClass="btn fw-bolder custom-2-1 w-full" (onClick)="exportarPDF()" raised text>
                    </p-button>
                  </div>
                  <div>
                    <p-button label="Excel" icon="bi bi-filetype-xlsx fw-medium icon-big"
                      styleClass="btn fw-bolder custom-2-2 w-full" (onClick)="exportarExcel()" raised text>
                    </p-button>
                  </div>
                </div>
              </p-popover>
            </div>

            <!-- Contenedor de los botones a la derecha -->
            <div class="right-search">
              <p-button label="Limpiar" icon="pi pi-filter-slash" [outlined]="true" styleClass="btn custom-slash"
                (click)="clear(dt)" class="responsive" />

              <p-iconField iconPosition="right">
                <p-inputIcon class="pi pi-search" />
                <input pInputText type="text" class="custom-search-input" placeholder="Buscar usuario"
                  [(ngModel)]="searchValue" (input)="applyFilterGlobal($event, dt)" />
              </p-iconField>
            </div>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th class="centered-header" style="min-width: 6rem">
            <div class="flex items-center">
              N°
              <p-columnFilter type="text" field="idBitacora" display="menu" />
            </div>
          </th>
          <th class="centered-header" style="min-width: 15rem">
            <div class="flex items-center">
              Autor del Evento
              <p-columnFilter type="text" field="UsuarioNombreCompleto" display="menu"></p-columnFilter>
            </div>
          </th>
          <th class="centered-header" style="min-width: 15rem">
            <div class="flex items-center">
              Objeto
              <p-columnFilter type="text" field="NombreObjeto" display="menu"></p-columnFilter>
            </div>
          </th>
          <th class="centered-header" style="min-width: 20rem">
            <div class="flex items-center">
              Descripción
              <p-columnFilter type="text" field="descripcion" display="menu"></p-columnFilter>
            </div>
          </th>
          <th class="centered-header" style="min-width: 8rem">
            <div class="flex items-center">
              Acción
              <p-columnFilter type="text" field="accion" display="menu"></p-columnFilter>
            </div>
          </th>
          <th class="centered-header" style="min-width: 12rem">
            <div class="flex items-center">
              Fecha del Evento
              <p-columnFilter type="date" dateFormat="dd 'de' MM 'del' yy" field="fechaRegistro"
                display="menu"></p-columnFilter>
            </div>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-bitacora>
        <tr>
          <td class="centered-cell">{{ bitacora.idBitacora || 'No proporcionado' }}</td>
          <td class="centered-cell">{{ bitacora.UsuarioNombreCompleto || 'No proporcionado' }}</td>
          <td class="centered-cell">{{ bitacora.NombreObjeto || 'No proporcionado' }}</td>
          <td class="centered-cell">{{ bitacora.descripcion || 'No proporcionado' }}</td>
          <td class="centered-cell">{{ bitacora.accion || 'No proporcionado' }}</td>
          <td class="centered-cell">
            {{ bitacora.fechaRegistro ? (bitacora.fechaRegistro | date: 'dd/MM/yyyy HH:mm:ss' : 'es') : 'No proporcionado' }}
          </td>

        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">

        <tr>
          <td colspan="8" class="centered-cell">
            No se encontraron usuarios.
          </td>
        </tr>
      </ng-template>

    </p-table>
    <br>

  </p-panel>
</div>
}