<p-toast [breakpoints]="{ '920px': { width: '100%', right: '0', left: '0' } }" />

@if (!loadingtable) {
<div class="custom-container">

  <p-panel class="transparente">
    <div class="header-container title-header gap-2">
      <span>
        Historial de Solicitudes
      </span>
    </div>

    <br>
    <br>

    <p-tabs value="0" scrollable [(value)]="activeTab" (valueChange)="onTabChange($event)">
      @if (mostrarTabs) {
        <p-tablist>
          <p-tab [value]="0">Solicitudes Estratégicas</p-tab>
          <p-tab [value]="1">Solicitudes Curriculares</p-tab>
          <p-tab [value]="2">Solicitudes Administrativas</p-tab>
        </p-tablist>
      }

      <p-tabpanels>
        @if (mostrarTabs) {
          <p-tabpanel [value]="0">
            @if (loadingSolicitudEstrategica) {
            <div class="flex flex-col items-center justify-center text-center h-full p-4"
              style="background-color: transparent;">
              <i class="pi pi-spin pi-spinner text-blue-500 text-4xl mb-4"></i>
              <p class="font-semibold text-gray-700 text-lg">
                Estamos cargando tus solicitudes estratégicas, por favor espera...
              </p>
            </div>
            }

            @if (!loadingSolicitudEstrategica) {
            <p-panel class="transparente" class="transparente">

              <p-table #dtEstrategica [value]="solicitudEstrategica" [paginator]="true" columnResizeMode="expand"
                showGridlines class="rounded-table" [tableStyle]="{ 'min-width': '50rem' }" [rows]="5"
                [rowsPerPageOptions]="[5, 15, 25]" dataKey="id"
                [globalFilterFields]="['numero','ticket','nombreSolicitud','estadoSolicitud', 'tipoSolicitud', 'fechaRegistro']">

                <ng-template pTemplate="caption">
                  <div class="toolbar">
                    <!-- Botones a la izquierda -->
                    <div class="centraciones">
                      <!-- Contenedor de los botones a la izquierda -->
                      <div class="left-buttons">
                        <p-button (onClick)="op.toggle($event)" icon="bi bi-file-earmark-spreadsheet fw-bolder"
                          label="Reportes" variant="text" [raised]="true" styleClass="btn fw-bolder custom-1" raised
                          text />
                        <p-popover #op>
                          <div class="flex flex-col gap-4">
                            <div>
                              <p-button label="PDF" icon="bi bi-filetype-pdf fw-medium icon-big"
                                styleClass="btn fw-bolder custom-2-1 w-full" (click)="exportarPDFEstrategica()" raised
                                text>
                              </p-button>
                            </div>
                            <div>
                              <p-button label="Excel" icon="bi bi-filetype-xlsx fw-medium icon-big"
                                styleClass="btn fw-bolder custom-2-2 w-full" (click)="exportarExcelEstrategica()" raised
                                text>
                              </p-button>
                            </div>
                          </div>
                        </p-popover>
                      </div>

                      <!-- Contenedor de los botones a la derecha -->
                      <div class="right-search">
                        <p-button label="Limpiar" icon="pi pi-filter-slash" [outlined]="true"
                          styleClass="btn custom-slash" class="responsive" (click)="clear(dtEstrategica)" />

                        <p-iconField iconPosition="right">
                          <p-inputIcon class="pi pi-search" />
                          <input pInputText type="text" class="custom-search-input" placeholder="Buscar ticket"
                            [(ngModel)]="searchValue" (input)="applyFilterGlobal($event, dtEstrategica)" />
                        </p-iconField>
                      </div>
                    </div>
                  </div>
                </ng-template>


                <ng-template pTemplate="header">
                  <tr>
                    <th class="centered-header" style="min-width: 5rem" rowspan="2">
                      <div class="flex items-center">
                        N°
                        <p-columnFilter type="text" field="numero" display="menu" />
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 10rem" rowspan="2">
                      <div class="flex items-center">
                        Ticket
                        <p-columnFilter type="text" field="ticket" display="menu" />
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 20rem" rowspan="2">
                      <div class="flex items-center">
                        Nombre de la Solicitud
                        <p-columnFilter type="text" field="nombreSolicitud" display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 12rem" rowspan="2">
                      <div class="flex items-center">
                        Estado de la Solicitud
                        <p-columnFilter type="text" field="estadoSolicitud" display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 15rem" rowspan="2">
                      <div class="flex items-center">
                        Tipo de Solicitud
                        <p-columnFilter type="text" field="tipoSolicitud" display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 12rem" rowspan="2">
                      <div class="flex items-center">
                        Fecha de Registro
                        <p-columnFilter type="date" dateFormat="dd 'de' MM 'del' yy" field="fechaRegistro"
                          display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 8rem" [attr.colspan]="mostrarColumnaSalida ? 2 : 1">
                      <div class="flex items-center">
                        Archivos
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 8rem" rowspan="2">
                      <div class="flex align-items-center">Acciones</div>
                    </th>
                  </tr>

                  <!-- Segunda fila con subcolumnas -->
                  <tr>
                    <th class="centered-header">Recibidos</th>
                    @if (mostrarColumnaSalida) {
                    <th class="centered-header">Emitidos</th>
                    }
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-solicitud>
                  <tr>
                    <td class="centered-cell">{{ solicitud.numero || 'No proporcionado' }}</td>
                    <td class="centered-cell">{{ solicitud.ticket || 'No proporcionado' }}</td>
                    <td class="centered-cell">{{ solicitud.nombreSolicitud || 'No proporcionado' }}</td>
                    <td class="centered-cell"><span
                        class="px-3 py-1 rounded-full text-sm font-medium shadow-sm whitespace-normal break-words inline-block"
                        [ngStyle]="{
                  backgroundColor: srvHistorial.getColorFondo(solicitud.idEstadoSolicitud),
                  color: srvHistorial.getColorTexto(solicitud.idEstadoSolicitud),
                  maxWidth: '200px',
                  lineHeight: '1.2'
                }">
                        {{ solicitud.estadoSolicitud }}
                      </span></td>
                    <td class="centered-cell">{{ solicitud.tipoSolicitud || 'No proporcionado' }}</td>
                    <td class="centered-cell">
                      {{ solicitud.fechaRegistro ? (solicitud.fechaRegistro | date: "dd 'de' MMMM 'del' yyyy, h:mm:ss a")
                      :
                      'No proporcionado' }}
                    </td>

                    <!-- Columna: (Recibidos) -->
                    <td class="centered-cell">
                      <div class="flex justify-center items-center gap-2">
                        @for (archivo of solicitud.archivosEntrada; track archivo) {
                        <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
                          [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
                          [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-arrow-down'"
                          (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
                        </p-button>

                        <p-popover #filePopover>
                          <div [ngClass]="{
          'grid-cols-1': archivos.length === 1,
          'grid-cols-2': archivos.length === 2,
          'grid-cols-2 md:grid-cols-2 lg:grid-cols-2': archivos.length === 3,
          'grid-cols-2 md:grid-cols-2 lg:grid-cols-3': archivos.length >= 4
        }" class="grid gap-4 p-4">
                            @if (archivos && archivos.length > 0) {
                            @for (archivo of archivos; track archivo) {
                            <div
                              class="flex flex-col items-center file-container cursor-pointer hover:bg-blue-100 p-2 rounded transition"
                              (click)="descargarArchivo(archivo.url, archivo.nombre)">
                              <p-button class="icon-button" [rounded]="true" [outlined]="true"
                                [style.font-size]="'1.25rem'" [icon]="'bi bi-file-earmark-text'">
                              </p-button>
                              <span class="text-sm text-center mt-1 font-semibold max-w-[180px] truncate"
                                title="{{ archivo.nombre }}">
                                {{ archivo.nombre }}
                              </span>
                            </div>
                            }
                            } @else {
                            <p class="text-xs text-muted text-center col-span-2">
                              No hay archivos disponibles.
                            </p>
                            }
                          </div>
                        </p-popover>
                        }

                      </div>
                    </td>

                    <!-- Columna: (Emitidos) -->
                    @if (mostrarColumnaSalida) {
                    <td class="centered-cell">
                      <div class="flex justify-center items-center gap-2">

                        <!-- Si hay archivos de salida, los muestra -->
                        @if (solicitud.archivosSalida && solicitud.archivosSalida.length > 0) {
                        @for (archivo of solicitud.archivosSalida; track archivo) {
                        <p-button class="icon-button" [rounded]="true" [outlined]="true"
                          [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
                          [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-arrow-up'"
                          (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
                        </p-button>

                        <p-popover #filePopover>
                          <div [ngClass]="{
                          'grid-cols-1': archivos.length === 1,
                          'grid-cols-2': archivos.length === 2,
                          'grid-cols-2 md:grid-cols-2 lg:grid-cols-2': archivos.length === 3,
                          'grid-cols-2 md:grid-cols-2 lg:grid-cols-3': archivos.length >= 4
                        }" class="grid gap-4 p-4">

                            @if (archivos && archivos.length > 0) {
                            @for (archivo of archivos; track archivo) {
                            <div
                              class="flex flex-col items-center file-container cursor-pointer hover:bg-blue-100 p-2 rounded transition"
                              (click)="descargarArchivo(archivo.url, archivo.nombre)">
                              <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
                                [style.font-size]="'1.25rem'" [icon]="'bi bi-file-earmark-text'">
                              </p-button>
                              <span class="text-sm text-center mt-1 font-semibold max-w-[180px] truncate"
                                title="{{ archivo.nombre }}">
                                {{ archivo.nombre }}
                              </span>
                            </div>
                            }
                            } @else {
                            <p class="text-xs text-muted text-center col-span-2">No hay archivos disponibles.</p>
                            }

                          </div>
                        </p-popover>
                        }
                        } @else {
                        <p class="text-xs text-muted text-center col-span-2">No hay archivos de salida.</p>
                        }

                        <!-- Si no hay archivos de salida, muestra ícono gris -->
                        <ng-template #sinArchivoSalida>
                          <p-button class="icon-button p-button-secondary" [outlined]="true" [rounded]="true"
                            icon="pi pi-times-circle" pTooltip="No disponible" tooltipPosition="top" disabled></p-button>
                        </ng-template>

                      </div>
                    </td>
                    }

                    <td class="centered-cell">
                      <div class="flex justify-center items-center">
                        <p-button (onClick)="op.toggle($event)" icon="pi pi-angle-double-down pi-fw"
                          styleClass="btn fw-bolder custom-8" raised text></p-button>
                        <p-popover #op>

                          <div class="flex flex-col gap-4">

                            <p-button [loading]="loadingHistorial" [disabled]="loadingHistorial" label="Seguimiento"
                              [icon]="loadingHistorial ? 'pi pi-spin pi-spinner' : 'bi bi-hourglass-split'"
                              (onClick)="mostrarHistorials(solicitud.idSolicitud, solicitud.ticket)"
                              styleClass="btn fw-bolder custom-7 w-full"></p-button>

                            <p-button [loading]="loadingHistorial" [disabled]="loadingHistorial" label="Información"
                              [loading]="loadingInformacion" [disabled]="loadingInformacion"
                              [icon]="loadingInformacion ? 'pi pi-spin pi-spinner' : 'bi bi-info-circle'"
                              (click)="mostrarInformacionSolicitud(solicitud)"
                              pTooltip="Ver información detallada de la solicitud" tooltipStyleClass="tooltip-custom-7"
                              styleClass="btn fw-bolder custom-1 w-full"></p-button>

                          <p-button label="Seguimiento Archivos" [disabled]="loadingDialogGeneral"
                            [icon]="loadingDialogGeneral ? 'pi pi-spin pi-spinner' : 'pi pi-folder fw-medium'"
                            styleClass="btn fw-bolder custom-7 w-full"
                            (click)="abrirHistorial(solicitud.idSolicitud, solicitud.ticket)">
                          </p-button>

                            <p-button [loading]="loadingDialogAsignado" [disabled]="loadingDialogAsignado"
                              label="Asignados" [icon]="loadingDialogAsignado ? 'pi pi-spin pi-spinner' : 'pi pi-users'"
                              (onClick)="cargarAsigandosSolicitud(solicitud, 'Asignados')"
                              styleClass="btn fw-bolder custom-1 w-full"></p-button>

                          </div>
                        </p-popover>

                      </div>
                    </td>
                  </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">

                  <tr>
                    <td colspan="11" class="centered-cell">
                      No se encontraron datos.
                    </td>
                  </tr>
                </ng-template>

              </p-table>
              <br>

            </p-panel>
            }
          </p-tabpanel>
        }

        <p-tabpanel [value]="1">

          @if (loadingSolicitudCurricular) {
          <div class="flex flex-col items-center justify-center text-center h-full p-4"
            style="background-color: transparent;">
            <i class="pi pi-spin pi-spinner text-blue-500 text-4xl mb-4"></i>
            <p class="font-semibold text-gray-700 text-lg">
              Estamos cargando tus solicitudes curriculares, por favor espera...
            </p>
          </div>
          }

          @if (!loadingSolicitudCurricular) {
          <p-panel class="transparente">

            <p-table #dtCurricular [value]="solicitudCurricular" [paginator]="true" columnResizeMode="expand"
              showGridlines class="rounded-table" [tableStyle]="{ 'min-width': '50rem' }" [rows]="5"
              [rowsPerPageOptions]="[5, 15, 25]" dataKey="id"
              [globalFilterFields]="['numero','ticket','nombreSolicitud','fechaRegistro']">

              <ng-template pTemplate="caption">
                <div class="toolbar">
                  <!-- Botones a la izquierda -->
                  <div class="centraciones">
                    <!-- Contenedor de los botones a la izquierda -->
                    <div class="left-buttons">
                      <p-button (onClick)="op.toggle($event)" icon="bi bi-file-earmark-spreadsheet fw-bolder"
                        label="Reportes" variant="text" [raised]="true" styleClass="btn fw-bolder custom-1" raised
                        text />
                      <p-popover #op>
                        <div class="flex flex-col gap-4">
                          <div>
                            <p-button label="PDF" icon="bi bi-filetype-pdf fw-medium icon-big"
                              styleClass="btn fw-bolder custom-2-1 w-full" (click)="exportarPDFCurricular()" raised
                              text>
                            </p-button>
                          </div>
                          <div>
                            <p-button label="Excel" icon="bi bi-filetype-xlsx fw-medium icon-big"
                              styleClass="btn fw-bolder custom-2-2 w-full" (click)="exportarExcelCurricular()" raised
                              text>
                            </p-button>
                          </div>
                        </div>
                      </p-popover>
                    </div>

                    <!-- Contenedor de los botones a la derecha -->
                    <div class="right-search">
                      <p-button label="Limpiar" icon="pi pi-filter-slash" [outlined]="true"
                        styleClass="btn custom-slash" class="responsive" (click)="clear(dtCurricular)" />

                      <p-iconField iconPosition="right">
                        <p-inputIcon class="pi pi-search" />
                        <input pInputText type="text" class="custom-search-input" placeholder="Buscar ticket"
                          [(ngModel)]="searchValue" (input)="applyFilterGlobal($event, dtCurricular)" />
                      </p-iconField>
                    </div>
                  </div>
                </div>
              </ng-template>


              <ng-template pTemplate="header">
                <tr>
                  <th class="centered-header" style="min-width: 5rem" rowspan="2">
                    <div class="flex items-center">
                      N°
                      <p-columnFilter type="text" field="numero" display="menu" />
                    </div>
                  </th>
                  <th class="centered-header" style="min-width: 10rem" rowspan="2">
                    <div class="flex items-center">
                      Ticket
                      <p-columnFilter type="text" field="ticket" display="menu" />
                    </div>
                  </th>
                  <th class="centered-header" style="min-width: 20rem" rowspan="2">
                    <div class="flex items-center">
                      Nombre de la Solicitud
                      <p-columnFilter type="text" field="nombreSolicitud" display="menu"></p-columnFilter>
                    </div>
                  </th>
                  <th class="centered-header" style="min-width: 12rem" rowspan="2">
                    <div class="flex items-center">
                      Estado de la Solicitud
                      <p-columnFilter type="text" field="estadoSolicitud" display="menu"></p-columnFilter>
                    </div>
                  </th>

                  <th class="centered-header" style="min-width: 15rem" rowspan="2">
                    <div class="flex items-center">
                      Integrantes de la Subcomisión
                      <p-columnFilter type="text" field="nombre" display="menu"></p-columnFilter>
                    </div>
                  </th>

                  <th class="centered-header" style="min-width: 12rem" rowspan="2">
                    <div class="flex items-center">
                      Fecha de Registro
                      <p-columnFilter type="date" dateFormat="dd 'de' MM 'del' yy" field="fechaRegistro"
                        display="menu"></p-columnFilter>
                    </div>
                  </th>
                  <th class="centered-header" style="min-width: 8rem" [attr.colspan]="mostrarColumnaSalida ? 2 : 1">
                    <div class="flex items-center">
                      Archivos
                    </div>
                  </th>
                  <th class="centered-header" style="min-width: 8rem" rowspan="2">
                    <div class="flex align-items-center">Acciones</div>
                  </th>
                </tr>

                <!-- Segunda fila con subcolumnas -->
                <tr>
                  <th class="centered-header">Recibidos</th>
                  @if (mostrarColumnaSalida) {
                  <th class="centered-header">Emitidos</th>
                  }
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-solicitud>
                <tr>
                  <td class="centered-cell">{{ solicitud.numero || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ solicitud.ticket || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ solicitud.nombreSolicitud || 'No proporcionado'}}</td>
                  <td class="centered-cell">
                    <div style="display: flex; flex-direction: column; align-items: center;">

                      <p-button styleClass="icon-button" [rounded]="true" [outlined]="true" icon="bi bi-ui-checks"
                        [disabled]="loadingEtapa || !permisoActualizar"
                        [icon]="loadingEtapa ? 'pi pi-spin pi-spinner' : 'bi bi-ui-checks'"
                        tooltipStyleClass="tooltip-custom-7"
                        pTooltip="Ver estados por etapa" (onClick)="mostrarDetalleEstados(solicitud)">
                      </p-button>

                      <small class="font-semibold text-[#253a69] text-center"
                        style="font-size: 0.80rem;  margin-top: 10px;">
                        Estados
                      </small>
                    </div>
                  </td>
                  <td class="centered-cell">
                    <div class="flex flex-col items-center">
                      @if (solicitud.interna) {
                      <p-button (click)="cargarDatos(solicitud, 'Integrante')" styleClass="icon-buttons"
                        [disabled]="(loadingDialogGeneral && loadingSolicitudId !== solicitud.idSolicitud) || !permisoActualizar"
                        [rounded]="true" [outlined]="true"
                        [icon]="(loadingDialogGeneral && loadingSolicitudId === solicitud.idSolicitud) ? 'pi pi-spin pi-spinner' : 'pi pi-users'"
                        [ngClass]="{'no-efecto': !permisoActualizar}">
                      </p-button>
                      <small class="font-semibold text-[#ea6427] text-center mt-1" style="font-size: 0.80rem;">
                        Integrantes
                      </small>
                      } @else {
                      <p-button styleClass="icon-buttons no-link no-link-disabled" [rounded]="true" [outlined]="true"
                        [disabled]="true" [icon]="'pi pi-ban'">
                      </p-button>
                      <small class="font-semibold text-[#ea6427] text-center mt-1" style="font-size: 0.80rem;">
                        No disponible
                      </small>
                      }
                    </div>
                  </td>


                  <td class="centered-cell">
                    {{ solicitud.fechaRegistro ? (solicitud.fechaRegistro | date: "dd 'de' MMMM 'del' yyyy, h:mm:ss a")
                    :
                    'No proporcionado' }}
                  </td>

                  <!-- Columna: (Recibidos) -->
                  <td class="centered-cell">
                    <div class="flex justify-center items-center gap-2">
                      @for (archivo of solicitud.archivosEntrada; track archivo) {
                      <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
                        [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
                        [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-arrow-down'"
                        (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
                      </p-button>
                      <p-popover #filePopover>
                        <div [ngClass]="{
                            'grid-cols-1': archivos.length === 1,
                            'grid-cols-2': archivos.length === 2,
                            'grid-cols-2 md:grid-cols-2 lg:grid-cols-2': archivos.length === 3,
                            'grid-cols-2 md:grid-cols-2 lg:grid-cols-3': archivos.length >= 4
                          }" class="grid gap-4 p-4">
                          @if (archivos && archivos.length > 0) {
                          @for (archivo of archivos; track archivo) {
                          <div
                            class="flex flex-col items-center file-container cursor-pointer hover:bg-blue-100 p-2 rounded transition"
                            (click)="descargarArchivo(archivo.url, archivo.nombre)">
                            <p-button class="icon-button" [rounded]="true" [outlined]="true"
                              [style.font-size]="'1.25rem'" [icon]="'bi bi-file-earmark-text'">
                            </p-button>
                            <span class="text-sm text-center mt-1 font-semibold max-w-[180px] truncate"
                              title="{{ archivo.nombre }}">
                              {{ archivo.nombre }}
                            </span>
                          </div>
                          }
                          } @else {
                          <p class="text-xs text-muted text-center col-span-2">
                            No hay archivos disponibles.
                          </p>
                          }
                        </div>
                      </p-popover>
                      }

                    </div>
                  </td>

                  <!-- Columna: (Emitidos) -->
                  @if (mostrarColumnaSalida) {
                  <td class="centered-cell">
                    <div class="flex justify-center items-center gap-2">

                      @if (solicitud.archivosSalida && solicitud.archivosSalida.length > 0) {
                      @for (archivo of solicitud.archivosSalida; track archivo) {
                      <p-button class="icon-button" [rounded]="true" [outlined]="true"
                        [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
                        [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-arrow-up'"
                        (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
                      </p-button>
                      <p-popover #filePopover>
                        <div [ngClass]="{
                'grid-cols-1': archivos.length === 1,
                'grid-cols-2': archivos.length === 2,
                'grid-cols-2 md:grid-cols-2 lg:grid-cols-2': archivos.length === 3,
                'grid-cols-2 md:grid-cols-2 lg:grid-cols-3': archivos.length >= 4
              }" class="grid gap-4 p-4">
                          @if (archivos && archivos.length > 0) {
                          @for (archivo of archivos; track archivo) {
                          <div
                            class="flex flex-col items-center file-container cursor-pointer hover:bg-blue-100 p-2 rounded transition"
                            (click)="descargarArchivo(archivo.url, archivo.nombre)">
                            <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
                              [style.font-size]="'1.25rem'" [icon]="'bi bi-file-earmark-text'">
                            </p-button>
                            <span class="text-sm text-center mt-1 font-semibold max-w-[180px] truncate"
                              title="{{ archivo.nombre }}">
                              {{ archivo.nombre }}
                            </span>
                          </div>
                          }
                          } @else {
                          <p class="text-xs text-muted text-center col-span-2">
                            No hay archivos disponibles.
                          </p>
                          }
                        </div>
                      </p-popover>
                      }
                      } @else {
                      <p-button class="icon-button p-button-secondary" [outlined]="true" [rounded]="true"
                        icon="pi pi-times-circle" pTooltip="No disponible" tooltipPosition="top" 
                        tooltipStyleClass="tooltip-custom-7"
                        disabled
                      >
                      </p-button>
                      }

                    </div>
                  </td>
                  }

                  <td class="centered-cell">
                    <div class="flex justify-center items-center">
                      <p-button (onClick)="op.toggle($event)" icon="pi pi-angle-double-down pi-fw"
                        styleClass="btn fw-bolder custom-8" raised text></p-button>
                      <p-popover #op>

                        <div class="flex flex-col gap-4">

                          <p-button [loading]="loadingHistorial" [disabled]="loadingHistorial" label="Seguimiento"
                            [icon]="loadingHistorial ? 'pi pi-spin pi-spinner' : 'bi bi-hourglass-split'"
                            (onClick)="mostrarHistorials(solicitud.idSolicitud, solicitud.ticket)"
                            styleClass="btn fw-bolder custom-7 w-full"></p-button>

                          <p-button [loading]="loadingInformacion" [disabled]="loadingInformacion" label="Información"
                            [icon]="loadingInformacion ? 'pi pi-spin pi-spinner' : 'bi bi-info-circle'"
                            (click)="mostrarInformacionSolicitud(solicitud)"
                            pTooltip="Ver información detallada de la solicitud" tooltipStyleClass="tooltip-custom-7"
                            styleClass="btn fw-bolder custom-1 w-full"></p-button>

                          <p-button label="Seguimiento Archivos" [disabled]="loadingDialogGeneral"
                            [icon]="loadingDialogGeneral ? 'pi pi-spin pi-spinner' : 'pi pi-folder fw-medium'"
                            styleClass="btn fw-bolder custom-7 w-full"
                            (click)="abrirHistorial(solicitud.idSolicitud, solicitud.ticket)">
                          </p-button>

                          <p-button [loading]="loadingDialogAsignado" [disabled]="loadingDialogAsignado"
                            label="Asignados" [icon]="loadingDialogAsignado ? 'pi pi-spin pi-spinner' : 'pi pi-users'"
                            (onClick)="cargarAsigandosSolicitud(solicitud, 'Asignados')"
                            styleClass="btn fw-bolder custom-1 w-full">
                          </p-button>

                        </div>
                      </p-popover>

                    </div>
                  </td>
                </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">

                <tr>
                  <td colspan="11" class="centered-cell">
                    No se encontraron datos.
                  </td>
                </tr>
              </ng-template>

            </p-table>
            <br>

          </p-panel>
          }
        </p-tabpanel>

        @if (mostrarTabs) {
          <p-tabpanel [value]="2">

            @if (loadingSolicitudAdministrativa) {
            <div class="flex flex-col items-center justify-center text-center h-full p-4"
              style="background-color: transparent;">
              <i class="pi pi-spin pi-spinner text-blue-500 text-4xl mb-4"></i>
              <p class="font-semibold text-gray-700 text-lg">
                Estamos cargando tus solicitudes administrativas, por favor espera...
              </p>
            </div>
            }

            @if (!loadingSolicitudAdministrativa) {
            <p-panel class="transparente">
              <!-- contenido del panel -->

              <p-table #dtAdministrativa [value]="solicitudAdministrativa" [paginator]="true" columnResizeMode="expand"
                showGridlines class="rounded-table" [tableStyle]="{ 'min-width': '50rem' }" [rows]="5"
                [rowsPerPageOptions]="[5, 15, 25]" dataKey="id" [globalFilterFields]="['numero','ticket','nombreSolicitud','estadoSolicitud','tipoSolicitud', 'fechaRegistro'
              ]">

                <ng-template pTemplate="caption">
                  <div class="toolbar">
                    <!-- Botones a la izquierda -->
                    <div class="centraciones">
                      <!-- Contenedor de los botones a la izquierda -->
                      <div class="left-buttons">
                        <p-button (onClick)="op.toggle($event)" icon="bi bi-file-earmark-spreadsheet fw-bolder"
                          label="Reportes" variant="text" [raised]="true" styleClass="btn fw-bolder custom-1" raised
                          text />
                        <p-popover #op>
                          <div class="flex flex-col gap-4">
                            <div>
                              <p-button label="PDF" icon="bi bi-filetype-pdf fw-medium icon-big"
                                styleClass="btn fw-bolder custom-2-1 w-full" (click)="exportarPDFAdministrativa()" raised
                                text>
                              </p-button>
                            </div>
                            <div>
                              <p-button label="Excel" icon="bi bi-filetype-xlsx fw-medium icon-big"
                                styleClass="btn fw-bolder custom-2-2 w-full" (click)="exportarExcelAdministrativa()"
                                raised text>
                              </p-button>
                            </div>
                          </div>
                        </p-popover>
                      </div>

                      <!-- Contenedor de los botones a la derecha -->
                      <div class="right-search">
                        <p-button label="Limpiar" icon="pi pi-filter-slash" [outlined]="true"
                          styleClass="btn custom-slash" class="responsive" (click)="clear(dtAdministrativa)" />

                        <p-iconField iconPosition="right">
                          <p-inputIcon class="pi pi-search" />
                          <input pInputText type="text" class="custom-search-input " [(ngModel)]="searchValue"
                            placeholder="Buscar ticket" (input)="applyFilterGlobal($event, dtAdministrativa)" />
                        </p-iconField>
                      </div>
                    </div>
                  </div>
                </ng-template>


                <ng-template pTemplate="header">
                  <tr>
                    <th class="centered-header" style="min-width: 5rem" rowspan="2">
                      <div class="flex items-center">
                        N°
                        <p-columnFilter type="text" field="numero" display="menu" />
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 10rem" rowspan="2">
                      <div class="flex items-center">
                        Ticket
                        <p-columnFilter type="text" field="ticket" display="menu" />
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 15rem" rowspan="2">
                      <div class="flex items-center">
                        Nombre de la Solicitud
                        <p-columnFilter type="text" field="nombreSolicitud" display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 12rem" rowspan="2">
                      <div class="flex items-center">
                        Estado de la Solicitud
                        <p-columnFilter type="text" field="estadoSolicitud" display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 15rem" rowspan="2">
                      <div class="flex items-center">
                        Tipo de Solicitud
                        <p-columnFilter type="text" field="tipoSolicitud" display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 12rem" rowspan="2">
                      <div class="flex items-center">
                        Fecha de Registro
                        <p-columnFilter type="date" dateFormat="dd 'de' MM 'del' yy" field="fechaRegistro"
                          display="menu"></p-columnFilter>
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 8rem" [attr.colspan]="mostrarColumnaSalida ? 2 : 1">
                      <div class="flex items-center">
                        Archivos
                      </div>
                    </th>
                    <th class="centered-header" style="min-width: 8rem" rowspan="2">
                      <div class="flex align-items-center">Acciones</div>
                    </th>
                  </tr>

                  <!-- Segunda fila con subcolumnas -->
                  <tr>
                    <th class="centered-header">Recibidos</th>
                    @if (mostrarColumnaSalida) {
                    <th class="centered-header">Emitidos</th>
                    }

                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-solicitud>
                  <tr>
                    <td class="centered-cell">{{ solicitud.numero || 'No proporcionado'}}</td>
                    <td class="centered-cell">{{ solicitud.ticket || 'No proporcionado'}}</td>
                    <td class="centered-cell">{{ solicitud.nombreSolicitud || 'No proporcionado'}}</td>
                    <td class="centered-cell"><span
                        class="px-3 py-1 rounded-full text-sm font-medium shadow-sm whitespace-normal break-words inline-block"
                        [ngStyle]="{
                  backgroundColor: srvHistorial.getColorFondo(solicitud.idEstadoSolicitud),
                  color: srvHistorial.getColorTexto(solicitud.idEstadoSolicitud),
                  maxWidth: '200px',
                  lineHeight: '1.2'
                }">
                        {{ solicitud.estadoSolicitud }}
                      </span></td>
                    <td class="centered-cell">{{ solicitud.tipoSolicitud || 'No proporcionado' }}</td>

                    <td class="centered-cell">
                      {{ solicitud.fechaRegistro ? (solicitud.fechaRegistro | date: "dd 'de' MMMM 'del' yyyy, h:mm:ss a")
                      :
                      'No proporcionado' }}
                    </td>


                    <!-- Columna: (Recibidos) -->
                    <td class="centered-cell">
                      <div class="flex justify-center items-center gap-2">
                        @for (archivo of solicitud.archivosEntrada; track archivo) {
                        <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
                          [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
                          [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-arrow-down'"
                          (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
                        </p-button>
                        <p-popover #filePopover>
                          <div [ngClass]="{
                              'grid-cols-1': archivos.length === 1,
                              'grid-cols-2': archivos.length === 2,
                              'grid-cols-2 md:grid-cols-2 lg:grid-cols-2': archivos.length === 3,
                              'grid-cols-2 md:grid-cols-2 lg:grid-cols-3': archivos.length >= 4
                            }" class="grid gap-4 p-4">
                            @if (archivos && archivos.length > 0) {
                            @for (archivo of archivos; track archivo) {
                            <div
                              class="flex flex-col items-center file-container cursor-pointer hover:bg-blue-100 p-2 rounded transition"
                              (click)="descargarArchivo(archivo.url, archivo.nombre)">
                              <p-button class="icon-button" [rounded]="true" [outlined]="true"
                                [style.font-size]="'1.25rem'" [icon]="'bi bi-file-earmark-text'">
                              </p-button>
                              <span class="text-sm text-center mt-1 font-semibold max-w-[180px] truncate"
                                title="{{ archivo.nombre }}">
                                {{ archivo.nombre }}
                              </span>
                            </div>
                            }
                            } @else {
                            <p class="text-xs text-muted text-center col-span-2">
                              No hay archivos disponibles.
                            </p>
                            }
                          </div>
                        </p-popover>
                        }
                      </div>
                    </td>


                    <!-- Columna: (Emitidos) -->
                    @if (mostrarColumnaSalida) {
                    <td class="centered-cell">
                      <div class="flex justify-center items-center gap-2">

                        @if (solicitud.archivosSalida && solicitud.archivosSalida.length > 0) {
                        @for (archivo of solicitud.archivosSalida; track archivo) {
                        <p-button class="icon-button" [rounded]="true" [outlined]="true"
                          [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
                          [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-arrow-up'"
                          (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
                        </p-button>

                        <p-popover #filePopover>
                          <div [ngClass]="{
                  'grid-cols-1': archivos.length === 1,
                  'grid-cols-2': archivos.length === 2,
                  'grid-cols-2 md:grid-cols-2 lg:grid-cols-2': archivos.length === 3,
                  'grid-cols-2 md:grid-cols-2 lg:grid-cols-3': archivos.length >= 4
                }" class="grid gap-4 p-4">
                            @if (archivos && archivos.length > 0) {
                            @for (archivo of archivos; track archivo) {
                            <div
                              class="flex flex-col items-center file-container cursor-pointer hover:bg-blue-100 p-2 rounded transition"
                              (click)="descargarArchivo(archivo.url, archivo.nombre)">
                              <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
                                [style.font-size]="'1.25rem'" [icon]="'bi bi-file-earmark-text'">
                              </p-button>
                              <span class="text-sm text-center mt-1 font-semibold max-w-[180px] truncate"
                                title="{{ archivo.nombre }}">
                                {{ archivo.nombre }}
                              </span>
                            </div>
                            }
                            } @else {
                            <p class="text-xs text-muted text-center col-span-2">
                              No hay archivos disponibles.
                            </p>
                            }
                          </div>
                        </p-popover>
                        }
                        } @else {
                        <p-button class="icon-button p-button-secondary" [outlined]="true" [rounded]="true"
                          icon="pi pi-times-circle" pTooltip="No disponible" tooltipPosition="top" disabled>
                        </p-button>
                        }
                      </div>
                    </td>
                    }


                    <td class="centered-cell">
                      <div class="flex justify-center items-center">
                        <p-button (onClick)="op.toggle($event)" icon="pi pi-angle-double-down pi-fw"
                          styleClass="btn fw-bolder custom-8" raised text></p-button>
                        <p-popover #op>

                          <div class="flex flex-col gap-4">

                            <p-button [loading]="loadingHistorial" [disabled]="loadingHistorial" label="Seguimiento"
                              [icon]="loadingHistorial ? 'pi pi-spin pi-spinner' : 'bi bi-hourglass-split'"
                              (onClick)="mostrarHistorials(solicitud.idSolicitud, solicitud.ticket)"
                              styleClass="btn fw-bolder custom-7 w-full"></p-button>

                            <p-button [loading]="loadingInformacion" [disabled]="loadingInformacion" label="Información"
                              [icon]="loadingInformacion ? 'pi pi-spin pi-spinner' : 'bi bi-info-circle'"
                              (click)="mostrarInformacionSolicitud(solicitud)"
                              pTooltip="Ver información detallada de la solicitud" tooltipStyleClass="tooltip-custom-7"
                              styleClass="btn fw-bolder custom-1 w-full"></p-button>


                          <p-button label="Seguimiento Archivos" [disabled]="loadingDialogGeneral"
                            [icon]="loadingDialogGeneral ? 'pi pi-spin pi-spinner' : 'pi pi-folder fw-medium'"
                            styleClass="btn fw-bolder custom-7 w-full"
                            (click)="abrirHistorial(solicitud.idSolicitud, solicitud.ticket)">
                          </p-button>

                            <p-button [loading]="loadingDialogAsignado" [disabled]="loadingDialogAsignado"
                              label="Asignados" [icon]="loadingDialogAsignado ? 'pi pi-spin pi-spinner' : 'pi pi-users'"
                              (onClick)="cargarAsigandosSolicitud(solicitud, 'Asignados')"
                              styleClass="btn fw-bolder custom-1 w-full"></p-button>

                          </div>
                        </p-popover>

                      </div>
                    </td>

                  </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">

                  <tr>
                    <td colspan="11" class="centered-cell">
                      No se encontraron datos.
                    </td>
                  </tr>
                </ng-template>

              </p-table>
              <br>

            </p-panel>
            }
          </p-tabpanel>
        }

      </p-tabpanels>
    </p-tabs>
  </p-panel>
</div>
}


<!-------------- Dialog de Integrantes SubComisión ---------- -->
<p-dialog header="Header" [(visible)]="visibleIntegrante" [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '90vw' }" [draggable]="false"
  [resizable]="false">
  <ng-template pTemplate="header">
    <div class="header-container title-header gap-2">
      <div class="header-titles">Integrantes de la {{ nombreSubComision }} </div>
    </div>


  </ng-template>
  <form>
    <p-panel>
      <p-fluid>
        <div>
          <div class="table-container">
            <p-table [value]="integrantes" showGridlines [tableStyle]="{ 'min-width': '30rem' }" dataKey="id">

              <ng-template pTemplate="header">
                <tr>
                  <th class="centered-header" style="min-width: 7rem">N°</th>
                  <th class="centered-header" style="min-width: 10rem">Nombre</th>
                  <th class="centered-header" style="min-width: 10rem">Correo</th>
                  <th class="centered-header" style="min-width: 10rem">Número de Empleado</th>
                  <th class="centered-header" style="min-width: 10rem">Contacto</th>
                  <th class="centered-header" style="min-width: 10rem">Estado</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-integrante>
                <tr>
                  <td class="centered-cell">{{ integrante.numero || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ integrante.nombreCompleto || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ integrante.correo || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ integrante.numEmpleado || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ integrante.telefonos || 'No proporcionado' }}</td>
                  <td class="centered-cell">{{ integrante.estadoUsuario || 'No proporcionado' }}</td>
                </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">

                <tr>
                  <td colspan="6" class="centered-cell">
                    No se encontraron datos.
                  </td>
                </tr>
              </ng-template>

            </p-table>
          </div>
        </div>
      </p-fluid>
    </p-panel>
  </form>

</p-dialog>

<!-------------- Dialog de Asignados  ---------- -->
<p-dialog header="Header" [(visible)]="visibleAsignados" [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '90vw' }" [draggable]="false"
  [resizable]="false">


  <ng-template pTemplate="header">
    <div class="header-container title-header">
      <h2 class="header-titles">Asignados del {{ ticket }}</h2>
    </div>
  </ng-template>

  <form>
    <p-panel>

      <p-fluid>
        <div>
          <div class="table-container">
            <p-table [value]="asignado" showGridlines [tableStyle]="{ 'min-width': '30rem' }" dataKey="nombreAsignador"
              rowGroupMode="rowspan" groupRowsBy="nombreSolicitud,nombreAsignador" sortField="nombreSolicitud"
              sortMode="single"> <!-- Ordenar por fecha -->

              <ng-template pTemplate="header">
                <tr>
                  <th class="centered-header" style="min-width: 7rem">N°</th>
                  <th class="centered-header" style="min-width: 10rem">Nombre de la Solicitud</th>
                  <th class="centered-header" style="min-width: 10rem">Supervisor de la Asignación</th>
                  <th class="centered-header" style="min-width: 10rem">Responsables Asignados</th>
                  <th class="centered-header" style="min-width: 10rem">Fecha de Finalización</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-asignado let-rowgroup="rowgroup" let-rowspan="rowspan">
                <tr>
                  <td class="centered-cell">{{ asignado.numero || 'No proporcionado' }}</td>


                  <!-- Mostrar solo si es rowgroup para aplicar rowspan (nombreSolicitud) -->
                  @if (rowgroup) {
                  <td class="centered-cell" [attr.rowspan]="rowspan">
                    {{ asignado.nombreSolicitud || 'No proporcionado' }}
                  </td>
                  }

                  @if (rowgroup) {
                  <td class="centered-cell" [attr.rowspan]="rowspan">
                    {{ asignado.nombreAsignador || 'No proporcionado' }}
                  </td>
                  }
                  <td class="centered-cell">{{ asignado.nombreAsignado || 'No proporcionado' }}</td>


                  <!-- Mostrar solo si es rowgroup para aplicar rowspan (fechaFinalizacion) -->
                  <td class="centered-cell">
                    {{ asignado.fechaFinalizacion ? (asignado.fechaFinalizacion | date: "dd 'de' MMMM 'del' yyyy,
                    h:mm:ss a") : 'No proporcionado' }}
                  </td>
                </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="5" class="centered-cell">No hay personas asignadas a esta solicitud {{ ticket }}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-fluid>
    </p-panel>
  </form>

</p-dialog>

<!-------------- Dialog de Estados por Etapa---------- -->
<p-dialog header="Header" [(visible)]="visibleEtapas" [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '60vw' }" [draggable]="false"
  [resizable]="false">


  <ng-template pTemplate="header">
    <div class="header-container title-header">
      <h2 class="header-titles">Etapas del Ticket {{ solicitudSeleccionada?.ticket }}</h2>
    </div>
  </ng-template>


  <p-table [value]="estadosSeleccionados" columnResizeMode="expand" showGridlines
    [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
      <tr>
        <th class="centered-header">Etapa</th>
        <th class="centered-header">Estado</th>
        <th class="centered-header">Seguimiento</th>
        <th class="centered-header">Plantillas Recibidas</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData>
      <tr>
        <td class="centered-cell">{{ rowData.etapa }}</td>
        <td class="centered-cell">
          <span class="px-2 py-1 rounded-full text-sm font-medium shadow-sm inline-block"
            [ngStyle]="{
            backgroundColor: srvHistorial.getColorFondo(rowData.idEstadoSolicitud),  color: srvHistorial.getColorTexto(rowData.idEstadoSolicitud)}">
            {{ rowData.estadoSolicitud }}
          </span>
        </td>
        <td>
          <p-button [loading]="loadingHistorial" [disabled]="loadingHistorial" badgeSeverity="warn"
            [label]="'Seguimiento - ' + rowData.etapa" icon="bi bi-hourglass-split" (onClick)="
                mostrarHistorials(
                  solicitudSeleccionada?.idSolicitud,
                  solicitudSeleccionada?.ticket,
                  solicitudSeleccionada.idEtapa
                )" styleClass="btn fw-bolder custom-7 w-full btn-small-text"></p-button>
        </td>
        <td class="centered-cell">
          <div class="flex flex-col justify-center items-center gap-1">
            @if (getArchivosPlantillaPorEtapa(rowData.idEtapa).length > 0) {
            @for (archivo of getArchivosPlantillaPorEtapa(rowData.idEtapa); track archivo) {
            <p-button styleClass="icon-button" [rounded]="true" [outlined]="true"
              [disabled]="loadingBtnKey && loadingBtnKey !== archivo.keys"
              [icon]="loadingBtnKey === archivo.keys ? 'pi pi-spin pi-spinner' : 'bi bi-file-earmark-post'"
              (click)="cargarArchivos($event, archivo.nombreArchivo, archivo.keys, archivo.bucket)">
            </p-button>
            }
            } @else {
            <p-button styleClass="icon-button" [rounded]="true" [outlined]="true" [disabled]="true"
              [icon]="'bi bi-file-earmark-post'">
            </p-button>
            <span class="text-xs text-center text-muted italic">No disponible</span>
            }
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

</p-dialog>

<!-------------- Dialog de Información de la Solicitud ---------- -->
<p-dialog header="Header" [(visible)]="visibleInformacion" [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '60vw' }" [draggable]="false"
  [resizable]="false" (onHide)="cerrarDialogoInformacion()">

  <ng-template pTemplate="header">
    <div class="header-container title-header gap-2">
      <div class="header-titles">
        Información del Ticket {{ ticket }}
      </div>
    </div>
  </ng-template>

  @if (solicitudSeleccionada) {
  <div>

    <!-- Información General -->
    <p-table [value]="[solicitudSeleccionada]" [tableStyle]="{ 'min-width': '100%' }" showGridlines>
      <ng-template pTemplate="header">
        <tr class="centered-cell">
          <th class="centered-header" colspan="2">
            Información General
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-solicitud>
        <tr>
          <td class="centered-header">Ticket</td>
          <td class="centered-cell">{{ solicitud.ticket || 'No proporcionado' }}</td>
        </tr>
        <tr>
          <td class="centered-header">Nombre de la Solicitud</td>
          <td class="centered-cell">{{ solicitud.nombreSolicitud || 'No proporcionado' }}</td>
        </tr>
        <tr>
          <td class="centered-header">Fecha de Registro</td>
          <td class="centered-cell">{{ formatearFecha(solicitud.fechaRegistro) }}</td>
        </tr>
      </ng-template>
    </p-table>

    <br>

    <!-- Información del Solicitante -->
    <p-table [value]="[solicitudSeleccionada]" [tableStyle]="{ 'min-width': '100%' }" showGridlines>
      <ng-template pTemplate="header">
        <tr class="centered-cell">
          <th class="centered-header" colspan="2">
            Información del Solicitante
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-solicitud>
        <tr>
          <td class="centered-header">Nombre Completo</td>
          <td class="centered-cell">{{ solicitud.nombreCompleto || 'No proporcionado' }}</td>
        </tr>
        <tr>
          <td class="centered-header">Correo Electrónico</td>
          <td class="centered-cell">{{ solicitud.correo || 'No proporcionado' }}</td>
        </tr>
        <tr>
          <td class="centered-header">Teléfono</td>
          <td class="centered-cell">{{ solicitud.telefonos || 'No proporcionado' }}</td>
        </tr>
      </ng-template>
    </p-table>

  </div>
  }
</p-dialog>

<!-------------- Dialog de Historial de Solicitud---------- -->
<app-historial-modal [(visible)]="mostrarHistorial" [historialEstados]="historialEstados"
  [ticket]="nombreTicketSeleccionado">
</app-historial-modal>

<!-------------- Dialog de Historial de Archivo---------- -->
<app-historial-archivo #historialHijo [(visible)]="historialVisible" [idSolicitud]="idSolicitudSeleccionada"
  [ticket]="ticketSeleccionado">
</app-historial-archivo>

